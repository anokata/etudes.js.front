<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>
    <link rel="stylesheet" href="../style.css" media="all" />
    <style>
      .block {
        width: 4rem;
        height: 4rem;
        margin: 0.2rem;
        display: inline-block;
        color: #eee;
      }
      button {
        vertical-align: top;
      }
      #clones {
        outline: 1px solid #fc5;
      }
      .activate {
        background-color: #ac4;
      }
      .notify {
        position: fixed;
        background-color: #cd8;
        color: #222;
        font-size: 2em;
        padding: 1em;
      }
      .notifyHide {
        opacity: 0;
        transition: all 1s;
      }
      input {
        margin: 1em;
      }
      div {
        margin: 1rem auto;
        background-color: #fffff8;
        padding: 1rem;
        border-radius: 1em;
      }
      img {
        width: 4rem;
        height: 4rem;
      }
    </style>
    <script defer src="deferred.js"></script>
    <script async src="asyncwork.js"></script>
  </head>
  <body>
    <main>
      <div>
        <button id="button">add</button>
        <div id="clones">clones:</div>
      </div>
      <div>
        <button id="clickMe">clickme</button>
        <button id="targetMe">target</button>
      </div>
      <input id="bgColorPick" type="color" list="#fafafa" />
      <div>
        <input type="text" id="notifyText">
        <button id="notifySend">notify</button>
      </div>
      <div>
        <input type="text" id="scriptName" value="loading.js">
        <button id="scriptLoad" >Load Script</button>
      </div>
      <div>
        <input type="text" id="imgName" value="https://github.githubassets.com/images/modules/profile/badge--acv-64.png">
        <button id="imgLoad" >Load iMAGE</button>
        <div id="images"></div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        console.log("DOMContentLoaded");
        button.addEventListener("click", addBlock);
      });
      let blockColorR = 20;
      addBlock();

      clickMe.addEventListener("click", () => {
        targetMe.classList.toggle("activate");
      });
      targetMe.addEventListener("click", () => {
        clickMe.classList.toggle("activate");
        bgColorPick.select();
      });

      bgColorPick.addEventListener("change", (e) => {
        console.log(e.target.value);
        document.body.style.backgroundColor = e.target.value;
      });

      bgColorPick.addEventListener("input", (e) => {
        document.body.style.backgroundColor = e.target.value;
      });

      showNotification({
        top: 10,
        right: 10,
        html: "Hello!",
        className: "welcome",
      });

      notifySend.addEventListener("click", () => {
        showNotification({
          top: 10, right: 10,
          html: notifyText.value,
          className: "",
        });
      });

      scriptLoad.addEventListener("click", () => {
        let script = document.createElement("script");
        let scriptname = scriptName.value || "loading.js";
        script.src = scriptname;
        script.addEventListener("load", () => {
          alert(done());
        });
        script.onerror = () => {alert(`script load error: ${scriptname}`)};

        document.head.append(script);

        console.log("loading...")
      });

      imgLoad.addEventListener("click", () => {
        let img = document.createElement("img");
        let imgname = imgName.value;
        img.src = imgname;
        img.addEventListener("load", () => {
          images.append(img);
        });
        img.onerror = () => {alert(`image load error: ${imgname}`)};
      });



      function showNotification(s) {
        let {top, right, html, className} = s;
        let notify = document.createElement("div");
        if (className)
          notify.classList.add(className);
        notify.classList.add("notify");
        notify.style.top = `${top}px`;
        notify.style.right = `${right}px`;
        notify.innerHTML = html;
        document.body.append(notify);
        setTimeout(() => { notify.classList.add('notifyHide');}, 1000);
        setTimeout(() => { notify.remove();}, 2000);
      }

      function addBlock() {
        let block = document.createElement("div");
        block.className = "block";
        block.style.setProperty(
          "background-color",
          `rgb(${blockColorR}, 80, 100)`
        );
        button.after(block);
        blockColorR += 20;
        block.addEventListener("click", addClone);
        block.append(`${blockColorR}`);
      }

      function addClone(e) {
        let el = e.target;
        let clone = el.cloneNode(true);
        clones.append(clone);
      }
    </script>
  </body>
</html>
