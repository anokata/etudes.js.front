<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="../style.css" media="all">
  <script src="../abbrev.js"></script>
  <style>

    .clickdiv {
      background-color: #928;
    }
    .clickdiv2 {
      transform:scale(1.5);
      transition: transform 1s;
      border: .1rem solid #208;
    }
    div {
      width: 5rem;
      height: 5rem;
      background-color: #ac8;
      font-size: 10px;
      margin: 2em;
    }

    .hiding {
      opacity: 0;
      transition: all 1s;
    }
    #inner{
      background-color: #8ca;
      width: 4rem;
      height: 4rem;
      margin:auto;
    }
    .scroll {
      overflow: scroll;
    }
    .hover-selected {
      outline: 1px solid #22a;
      transition: all 200ms;
    }

  </style>
</head>
<body>
  mouseover
  mouseout
  oncontextmenu
  <div id="clickdiv"></div>
  <div id="menudiv"></div>
  <div id="hiding"></div>
  <div class="scroll">Lorem recusandae quos error quaerat porro accusantium non Expedita iure ab quam doloribus blanditiis? Reiciendis saepe assumenda sint harum magnam? Voluptas quis sunt a quam ab. Ipsum deserunt blanditiis magni?</div>

  <div id="bubbling">
    <div id="inner">bubble me</div>
  </div>
  
  <script>
    "use strict";
    let clickdiv = id("clickdiv");
    let menudiv = id("menudiv");

    clickdiv.onclick = function(e) {
      this.classList.toggle("clickdiv");
      e.stopPropagation();
    };
    clickdiv.addEventListener("click", function(){ this.classList.toggle("clickdiv2")});
    clickdiv.addEventListener("click", function(e){ log(e); });
    clickdiv.addEventListener("click", function(e){ this.textContent = `event
      type: ${e.type}
      at ${e.clientX}:${e.clientY}
      `;
      e.stopPropagation();
    });

    document.body.addEventListener("click", function(e) {
      document.body.classList.toggle("click");
      log(`click on ${e.target} caught by ${this}`);
      //e.stopPropagation();
    }, true);

    class Menu {
      name = 'menu';

      handleEvent(event) {
        let elem = event.target;
        switch(event.type) {
          case 'mousedown':
            elem.innerHTML = event.type;
            break;
          case 'mouseup':
            elem.innerHTML = `${event.type} ${this.name}`;
            break;
        }
      }
    }

    let menu = new Menu();
    menudiv.addEventListener('mousedown', menu);
    menudiv.addEventListener('mouseup', menu);

    id("hiding").addEventListener("mouseover", function(e) { this.classList.add('hiding'); e.stopPropagation();});
    id("hiding").addEventListener("transitionend", function(e) {this.classList.remove("hiding")}, false);

    id("bubbling").addEventListener("click", function(w){this.classList.toggle("clickdiv2");});

    let flag = false;
    // Stop all clicks
    document.body.addEventListener("click", function(e) {
      flag = !flag;
      log(flag);
      if (flag) {
        //e.stopPropagation();
        //e.stopImmediatePropagation();
      }
    }, {capture: true}); // on deep phase

    let scrollingDiv = document.querySelector(".scroll");
    let scrollDown = false;

    function isScrollAtBottom(el) {
      return el.scrollTop+el.clientHeight >= el.scrollHeight;
    }

    function isScrollAtTop(el) {
      return el.scrollTop == 0;
    }

    function scrollDiv() {
      if (isScrollAtBottom(scrollingDiv)) {
        scrollDown = false;
      }
      if (isScrollAtTop(scrollingDiv)) {
        scrollDown = true;
      }

      if (scrollDown) {
        scrollingDiv.scrollTop += 10;
      } else {
        scrollingDiv.scrollTop -= 5;
      }
      setTimeout(scrollDiv, 50);
    }
    setTimeout(scrollDiv, 50);

    document.body.addEventListener("mousemove", function(e) {
      let el = document.elementFromPoint(e.clientX, e.clientY);
      el.classList.add("hover-selected");
      setTimeout(() => el.classList.remove("hover-selected"), 1000);
    });
    
  </script>
</body>
</html>
